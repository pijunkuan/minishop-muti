(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1dd6adb0"],{"0776":function(t,e,n){t.exports=n.p+"templates/center/img/balloon_two_color.png"},"12de":function(t,e,n){"use strict";n.d(e,"c",(function(){return s})),n.d(e,"b",(function(){return a})),n.d(e,"a",(function(){return o}));var i=n("b775");function s(){return Object(i["a"])({url:"shop/template",method:"get"})}function a(t){return Object(i["a"])({url:"shop/template/"+t,method:"get"})}function o(t,e){return Object(i["a"])({url:"shop/template/"+e,method:"put",data:t})}},1832:function(t,e,n){"use strict";n.r(e);var i=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"web-container"},[i("div",{staticClass:"web-header"},[t._v(" 商城配置 "),i("div",{staticClass:"back-button",staticStyle:{cursor:"pointer"},on:{click:t.returnCenter}},[t._v("回到主控台")])]),i("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"back-content"},[1===t.activeIndex?i("set-basic",{attrs:{shop:t.shop,btnLoading:t.btnLoading},on:{confirm:t.setBasic}}):t._e(),2===t.activeIndex?i("set-theme",{attrs:{activeIndex:t.activeIndex,shop:t.shop,btnLoading:t.btnLoading},on:{confirm:t.confirmTheme,prev:t.toPrev,complete:t.confirm}}):t._e(),4===t.activeIndex?i("div",[t.isComplete?t._e():i("div",[t._m(0),i("div",{staticClass:"image-tip-text"},[t._v("安装中...")])]),i("transition",{attrs:{name:"success"}},[i("div",{directives:[{name:"show",rawName:"v-show",value:t.isComplete,expression:"isComplete"}],staticClass:"setup-success"},[i("div",{staticClass:"image-tip"},[i("img",{attrs:{src:n("bd25")}})]),i("div",{staticClass:"image-tip-text"},[t._v("安装成功")])])]),t.isComplete?i("div",{staticStyle:{"text-align":"center","margin-top":"40px"}},[i("el-button",{attrs:{type:"primary"},on:{click:t.returnCenter}},[t._v("回到商城列表")]),i("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.$router.push({name:"Dashboard"})}}},[t._v("进入商城")])],1):t._e()],1):t._e()],1)])},s=[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"image-tip image-tip-floating"},[i("img",{attrs:{src:n("0776")}})])}],a=(n("ac1f"),n("1276"),function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("div",{staticClass:"set-title"},[t._v("商城基础设置")]),i("div",{staticClass:"set-image",style:{height:t.height+"px"}},[i("img",{attrs:{src:n("b2f2")}})]),i("div",{staticClass:"set-form"},[i("div",{staticClass:"set-form-item"},[i("div",[t._v("商城名称")]),i("div",[i("el-input",{model:{value:t.shop.shop_name,callback:function(e){t.$set(t.shop,"shop_name",e)},expression:"shop.shop_name"}})],1)]),i("div",{staticClass:"set-form-item"},[i("div",[t._v("域名地址")]),i("div",[i("el-input",{attrs:{disabled:"免费版"===t.shop.shop_level},model:{value:t.shop.shop_url,callback:function(e){t.$set(t.shop,"shop_url",e)},expression:"shop.shop_url"}},[i("span",{attrs:{slot:"append"},slot:"append"},[t._v("."+t._s(t.shop.shop_host))])]),"免费版"===t.shop.shop_level?i("div",{staticClass:"set-tip"},[t._v("免费版域名地址自动生成，如需自定义域名地址，可在商城后台中升级")]):t._e()],1)]),i("div",{staticClass:"set-form-button"},[i("el-button",{attrs:{type:"primary",loading:t.btnLoading},on:{click:t.confirm}},[t._v("下一步")])],1)])])}),o=[],r={props:{shop:Object,btnLoading:Boolean},data:function(){return{height:0}},mounted:function(){var t=this;this.$nextTick((function(){window.innerHeight-482>100?t.height=window.innerHeight-482:t.height=100})),window.onresize=function(){window.innerHeight-482>100?t.height=window.innerHeight-482:t.height=100}},methods:{confirm:function(){this.$emit("confirm")}}},c=r,h=(n("29a87"),n("2877")),l=Object(h["a"])(c,a,o,!1,null,"78200c58",null),d=l.exports,u=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("div",{staticClass:"set-title"},[t._v("主题选择")]),void 0!==t.current_theme.template_id?n("div",{staticClass:"current-theme"},[t._v("当前主题："),n("strong",[t._v(t._s(t.current_theme.template_name))])]):t._e(),n("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"set-theme-list",style:{height:t.height+"px"}},t._l(t.themes,(function(e,i){return n("el-radio",{key:i,staticClass:"theme-items",attrs:{label:e,disabled:e.hasTheme},model:{value:t.selected_theme,callback:function(e){t.selected_theme=e},expression:"selected_theme"}},[n("div",[n("div",{staticClass:"theme-title"},[t._v("主题"+t._s(i+1)+"："),n("strong",[t._v(t._s(e.template_name))])]),n("div",{staticClass:"theme-image"},[n("el-image",{staticStyle:{width:"200px"},attrs:{fit:"contain",src:e.template_img}})],1),e.template_content?n("div",[t._v("适用场景："+t._s(e.template_content))]):t._e(),n("div",[n("span",[t._v("购买时长")]),n("el-select",{staticStyle:{width:"154px","margin-left":"10px"},attrs:{disabled:e.hasTheme},on:{change:function(n){return t.changeVariant(e)}},model:{value:e.current_variant_id,callback:function(n){t.$set(e,"current_variant_id",n)},expression:"theme.current_variant_id"}},t._l(e.variants,(function(t,e){return n("el-option",{key:"v"+e,attrs:{value:t.variant_id,label:t.time+"个月"}})})),1)],1),n("div",{staticClass:"theme-price"},[t._v("价格：¥ "),n("strong",[t._v(t._s(e.current_price))])])])])})),1),n("div",{staticClass:"payment-list"},[n("span",{staticStyle:{"margin-right":"10px"}},[t._v("支付方式：")]),n("el-radio-group",{attrs:{size:"small",disabled:t.themes.filter((function(t){return t.hasTheme})).length===t.themes.length},model:{value:t.payment_method,callback:function(e){t.payment_method=e},expression:"payment_method"}},t._l(t.payments,(function(e,i){return n("el-radio-button",{key:i,attrs:{label:e.method_code}},[t._v(t._s(e.method_title))])})),1)],1),n("div",{staticClass:"set-form-button"},[n("el-button",{attrs:{type:"primary",plain:""},on:{click:t.toPrev}},[t._v("上一步")]),n("el-button",{attrs:{type:"primary",disabled:t.themes.filter((function(t){return t.hasTheme})).length===t.themes.length,loading:t.payLoading},on:{click:t.toPay}},[t._v("保存")]),t.hasSet?n("el-button",{attrs:{type:"primary",plain:""},on:{click:t.toComplete}},[t._v("完成设置")]):t._e()],1),n("el-dialog",{attrs:{visible:t.tipShow,title:"提示","show-close":!1,"close-on-click-modal":!1,"close-on-press-escape":!1,center:""}},[n("div",{staticClass:"dialog-tip"},[n("div",[t._v("付款过程中请勿关闭当前页面，付款成功后请点击“付款成功”按钮，即可创建商城并设置商城基础信息")]),n("div",[t._v("付款失败或取消付款，请点击“取消付款”按钮，关闭弹窗")])]),n("div",{attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{size:"small"},on:{click:function(e){t.tipShow=!1}}},[t._v("取消付款")]),n("el-button",{attrs:{size:"small",type:"primary",loading:t.btnLoading},on:{click:t.validPay}},[t._v("付款成功")])],1)])],1)},p=[],m=(n("4de4"),n("d81d"),n("a9e3"),n("12de")),v=n("e692"),g=n("825f"),_={props:{shop:Object,activeIndex:Number},data:function(){return{loading:!1,themes:[],height:0,selected_theme:{},selected_variant_id:"",payments:[],payment_method:"",payVisible:!1,payTitle:"",gotUrl:!1,url:"",current_theme:{},payLoading:!1,tipShow:!1,order_no:"",hasSet:!1,btnLoading:!1}},mounted:function(){var t=this;this.$nextTick((function(){t.height=window.innerHeight-377})),window.onresize=function(){t.height=window.innerHeight-377}},methods:{getThemes:function(){var t=this;this.loading=!0,Object(m["c"])().then((function(e){0!==e.data.body.length&&(t.hasSet=!0,t.current_theme=e.data.body.filter((function(t){return t.active}))[0]),t.getPayments(),Object(v["d"])().then((function(n){if(t.themes=n.data.body,t.loading=!1,0!==t.themes.length){t.selected_theme=t.themes[0],t.selected_variant_id=t.themes[0].variants[0].variant_id;var i=e.data.body;t.themes.map((function(t){t["current_variant_id"]=t.variants[0].variant_id,t["current_price"]=t.variants[0].price,0!==i.length&&0!==i.filter((function(e){return e.template_id===t.template_id})).length?t["hasTheme"]=!0:t["hasTheme"]=!1}))}})).catch((function(){t.loading=!1}))})).catch((function(){t.loading=!1}))},getPayments:function(){var t=this;Object(g["d"])().then((function(e){t.payments=e.data.body,t.payment_method=t.payments[0].method_code}))},changeVariant:function(t){t.current_price=t.variants.filter((function(e){return e.variant_id===t.current_variant_id}))[0].price,this.selected_variant_id=t.current_variant_id},toPrev:function(){this.$emit("prev")},toComplete:function(){this.$emit("complete")},toPay:function(){var t=this;this.payLoading=!0;var e={shop_id:this.$store.getters.shop_id,payment_method:this.payment_method,item:{type:"template",item_id:this.selected_variant_id}};Object(g["a"])(e).then((function(e){t.order_no=e.data.body.no,"免费版"===t.$store.getters.shop_level?(t.payLoading=!1,t.hasSet=!0,t.confirm()):(window.open(e.data.body.payment.pay_url,"_blank"),t.payLoading=!1,t.tipShow=!0)})).catch((function(){t.payLoading=!1}))},validPay:function(){var t=this;this.$loading(),Object(g["c"])(this.order_no).then((function(e){"paid"===e.data.body.status_code?(t.$message.success({message:"主题购买成功",duration:1e3}),setTimeout((function(){t.confirm(),t.hasSet=!0,t.$loading().close()}),1e3)):(t.$message.error({message:"未检测到成功的支付订单，请检查支付是否成功，如果确认支付成功，请联系客服核对并开通商城",duration:4e3}),t.$loading().close())})).catch((function(e){t.$message.error({message:e.response.data.message,duration:2e3}),t.$loading().close()}))},closePay:function(){this.payVisible=!1,this.gotUrl=!1,this.url="",this.payTitle=""},confirm:function(){this.$emit("confirm")}},watch:{activeIndex:{deep:!0,immediate:!0,handler:function(){2===this.activeIndex&&this.getThemes()}}}},f=_,b=(n("b64f"),n("f06a"),Object(h["a"])(f,u,p,!1,null,"8804ccce",null)),y=b.exports,w={components:{SetBasic:d,SetTheme:y},data:function(){return{activeIndex:1,loading:!1,shop:{shop_name:"",shop_level:"",shop_url:"",shop_status:"",shop_id:"",shop_active:"",shop_host:"",shop_exp:""},btnLoading:!1,isComplete:!1,changeName:!1,changeUrl:!1}},created:function(){this.loading=!0},methods:{toPrev:function(){this.activeIndex-=1,this.changeName=!1,this.changeUrl=!1},setBasic:function(){var t=this;if(this.changeName||this.changeUrl){this.btnLoading=!0;var e={shop_name:this.shop.shop_name,shop_url:this.shop.shop_url};Object(v["a"])(e).then((function(){t.activeIndex=2,t.btnLoading=!1})).catch((function(){t.btnLoading=!1}))}else this.activeIndex=2},confirmTheme:function(){this.$message.success("创建主题成功"),this.confirm()},confirm:function(){var t=this;this.activeIndex=4,Object(v["a"])({status:"active"}).then((function(){setTimeout((function(){t.isComplete=!0}),5e3)})).catch((function(e){t.activeIndex=3,t.$message.error(e.response.data.message)}))},returnCenter:function(){var t=location.origin.split("."),e="//account."+t[t.length-2]+"."+t[t.length-1];location.href=e}},watch:{"$store.getters.shop_status":{handler:function(t){""!==t&&(this.loading=!1,this.shop.shop_name=this.$store.getters.shop_name,this.shop.shop_level=this.$store.getters.shop_level,this.shop.shop_url=this.$store.getters.shop_url,this.shop.shop_id=this.$store.getters.shop_id,this.shop.shop_status=this.$store.getters.shop_status,this.shop.shop_host=this.$store.getters.shop_host,this.shop.shop_active=this.$store.getters.shop_active,this.shop.shop_exp=this.$store.getters.shop_exp,"active"===this.shop.shop_status&&this.$router.push({name:"Dashboard"}))}},"shop.shop_name":{deep:!0,immediate:!0,handler:function(t,e){this.changeName=t!==e}},"shop.shop_url":{deep:!0,immediate:!0,handler:function(t,e){this.changeUrl=t!==e}}}},x=w,C=(n("a0ab"),Object(h["a"])(x,i,s,!1,null,"61467722",null));e["default"]=C.exports},"29a87":function(t,e,n){"use strict";var i=n("81fc"),s=n.n(i);s.a},"2d31":function(t,e,n){},"81fc":function(t,e,n){},"825f":function(t,e,n){"use strict";n.d(e,"a",(function(){return m})),n.d(e,"c",(function(){return v})),n.d(e,"d",(function(){return g})),n.d(e,"f",(function(){return _})),n.d(e,"b",(function(){return f})),n.d(e,"e",(function(){return b}));n("d3b7"),n("ac1f"),n("1276");var i=n("d4ec"),s=n("bee2"),a=n("bc3a"),o=n.n(a),r=n("4360"),c=n("5f87"),h=n("5c96"),l=o.a.create({baseURL:location.origin+"/api"}),d=function(){function t(){Object(i["a"])(this,t)}return Object(s["a"])(t,[{key:"success",value:function(e){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this[t]("success",e,n)}},{key:"warning",value:function(e){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this[t]("warning",e,n)}},{key:"info",value:function(e){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this[t]("info",e,n)}},{key:"error",value:function(e){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this[t]("error",e,n)}},{key:t,value:function(t,e,n){n?0===document.getElementsByClassName("el-message").length&&h["Message"][t](e):h["Message"][t](e)}}]),t}(),u=new d;l.interceptors.request.use((function(t){return r["a"].getters.token&&(t.headers["Authorization"]="Bearer "+Object(c["b"])()),t}),(function(t){return Promise.reject(t)})),l.interceptors.response.use((function(t){return t}),(function(t){if(401===t.response.status){u.error("登录超时，请重新登录");var e=location.origin.split("."),n="//account."+e[e.length-2]+"."+e[e.length-1]+"/login";r["a"].dispatch("logout"),setTimeout((function(){location.href=n}),500)}return Promise.reject(t)}));var p=l;function m(t){return p({url:"/shop/order",method:"post",data:t})}function v(t){return p({url:"/shop/order/"+t,method:"get"})}function g(){return p({url:"/shop/sys/payment_method",method:"get"})}function _(){return p({url:"/shop/sys/sms",method:"get"})}function f(){return p({url:"/account/contrast",method:"get"})}function b(){return p({url:"/shop/sys/level",method:"get"})}},a0ab:function(t,e,n){"use strict";var i=n("2d31"),s=n.n(i);s.a},ace0:function(t,e,n){},b2f2:function(t,e,n){t.exports=n.p+"templates/center/img/marginalia-online-shopping.png"},b64f:function(t,e,n){"use strict";var i=n("e179"),s=n.n(i);s.a},bd25:function(t,e,n){t.exports=n.p+"templates/center/img/shopping.png"},e179:function(t,e,n){},f06a:function(t,e,n){"use strict";var i=n("ace0"),s=n.n(i);s.a}}]);