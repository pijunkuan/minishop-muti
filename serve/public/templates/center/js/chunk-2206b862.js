(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2206b862"],{"0b6d":function(t,i,e){},"11d5":function(t,i,e){"use strict";var s=e("0b6d"),n=e.n(s);n.a},"825f":function(t,i,e){"use strict";e.d(i,"a",(function(){return h})),e.d(i,"c",(function(){return p})),e.d(i,"d",(function(){return m})),e.d(i,"e",(function(){return y})),e.d(i,"b",(function(){return _}));e("d3b7"),e("ac1f"),e("1276");var s=e("d4ec"),n=e("bee2"),a=e("bc3a"),o=e.n(a),r=e("4360"),c=e("5f87"),l=e("5c96"),d=o.a.create({baseURL:location.origin+"/api"}),u=function(){function t(){Object(s["a"])(this,t)}return Object(n["a"])(t,[{key:"success",value:function(i){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this[t]("success",i,e)}},{key:"warning",value:function(i){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this[t]("warning",i,e)}},{key:"info",value:function(i){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this[t]("info",i,e)}},{key:"error",value:function(i){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this[t]("error",i,e)}},{key:t,value:function(t,i,e){e?0===document.getElementsByClassName("el-message").length&&l["Message"][t](i):l["Message"][t](i)}}]),t}(),g=new u;d.interceptors.request.use((function(t){return r["a"].getters.token&&(t.headers["Authorization"]="Bearer "+Object(c["b"])()),t}),(function(t){return Promise.reject(t)})),d.interceptors.response.use((function(t){return t}),(function(t){if(401===t.response.status){g.error("登录超时，请重新登录");var i=location.origin.split("."),e="//account."+i[i.length-2]+"."+i[i.length-1]+"/login";r["a"].dispatch("logout"),setTimeout((function(){location.href=e}),500)}return Promise.reject(t)}));var v=d;function h(t){return v({url:"/shop/order",method:"post",data:t})}function p(t){return v({url:"/shop/order/"+t,method:"get"})}function m(){return v({url:"/shop/sys/payment_method",method:"get"})}function y(){return v({url:"/shop/sys/sms",method:"get"})}function _(){return v({url:"/account/contrast",method:"get"})}},cc40:function(t,i,e){},e5a7:function(t,i,e){"use strict";var s=e("cc40"),n=e.n(s);n.a},f9b0:function(t,i,e){"use strict";e.r(i);var s=function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",[e("div",{staticClass:"message-header"},[e("div",[e("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.editSign}},[t._v("设置签名")])],1),e("div",[e("span",[t._v("短信通知："+t._s(t.$store.getters.shop_sms)+" 条可用")]),e("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary",size:"mini"},on:{click:t.toBuy}},[t._v("购买短信")]),e("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary",size:"mini"},on:{click:t.smsHistory}},[t._v("短信使用历史")])],1)]),e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"message-content"},[e("div",{staticClass:"message-content-header"},[t._v("顾客通知")]),t._l(t.customer_templates,(function(i,s){return e("div",{key:s,staticStyle:{"margin-bottom":"20px"}},[e("div",{staticClass:"message-content__title"},[t._v(t._s(i[0].type))]),t._m(0,!0),t._l(i,(function(s,n){return e("div",{key:"i"+n,staticClass:"message-content__item"},[e("div",{staticStyle:{width:"240px"}},[t._v(t._s(s.template_name))]),e("div",{staticStyle:{width:"calc(100% - 360px)"}},[t._v(t._s(s.template_content))]),e("div",{staticStyle:{width:"50px"}},[t._v(t._s(s.active?"启用":"停用"))]),e("div",{staticStyle:{width:"60px"}},[e("el-button",{attrs:{type:s.active?"danger":"primary",size:"mini",disabled:"登录与注册"===i[0].type,loading:s.isLoading},on:{click:function(i){return t.changeStatus(s)}}},[t._v(t._s(s.active?"停用":"启用"))])],1)])}))],2)}))],2),e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"message-content"},[e("div",{staticClass:"message-content-header"},[t._v("管理员通知")]),t._l(t.admin_templates,(function(i,s){return e("div",{key:s,staticStyle:{"margin-bottom":"20px"}},[e("div",{staticClass:"message-content__title"},[t._v(t._s(i[0].type))]),t._m(1,!0),t._l(i,(function(i,s){return e("div",{key:"i"+s,staticClass:"message-content__item"},[e("div",{staticStyle:{width:"240px"}},[t._v(t._s(i.template_name))]),e("div",{staticStyle:{width:"calc(100% - 360px)"}},[t._v(t._s(i.template_content))]),e("div",{staticStyle:{width:"50px"}},[t._v(t._s(i.active?"启用":"停用"))]),e("div",{staticStyle:{width:"60px"}},[e("el-button",{attrs:{type:i.active?"danger":"primary",loading:i.isLoading,size:"mini"},on:{click:function(e){return t.changeStatus(i)}}},[t._v(t._s(i.active?"停用":"启用"))])],1)])}))],2)}))],2),e("el-dialog",{attrs:{visible:t.buyVisible,title:"购买短信",width:"800px","before-close":t.closeBuy}},[e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.payLoading,expression:"payLoading"}]},[e("div",{staticClass:"buy-item"},[e("div",{staticStyle:{width:"70px"}},[t._v("购买数量")]),e("div",[e("el-radio-group",{attrs:{size:"small"},model:{value:t.message_type,callback:function(i){t.message_type=i},expression:"message_type"}},t._l(t.message_types,(function(i,s){return e("el-radio-button",{key:s,attrs:{label:i}},[t._v(t._s((1*i.time).toFixed(0)))])})),1)],1)]),e("div",{staticClass:"buy-item"},[e("div",{staticStyle:{width:"70px"}},[t._v("支付方式")]),e("div",[e("el-radio-group",{attrs:{size:"small"},model:{value:t.current_payment,callback:function(i){t.current_payment=i},expression:"current_payment"}},t._l(t.payments,(function(i,s){return e("el-radio-button",{key:s,attrs:{label:i.method_code}},[t._v(t._s(i.method_title))])})),1)],1)]),e("div",{staticClass:"buy-price"},[e("div",[t._v("共购买"),e("strong",[t._v(" "+t._s((1*t.message_type.time).toFixed(0))+" ")]),t._v("条短信")]),e("div",{staticStyle:{"margin-top":"5px"}},[t._v("应付金额 "),e("span",[t._v("¥"),e("strong",[t._v(" "+t._s(t.message_type.price)+" ")])])])]),e("div",{staticClass:"buy-footer"},[e("el-button",{attrs:{size:"small"},on:{click:t.closeBuy}},[t._v("取消")]),e("el-button",{attrs:{size:"small",type:"primary",loading:t.buyLoading},on:{click:t.confirmBuy}},[t._v("确定")])],1)])]),e("el-dialog",{attrs:{visible:t.signVisible,title:"设置签名",width:"500px","before-close":t.closeSign}},[e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.signLoading,expression:"signLoading"}],staticClass:"sign-page"},[e("div",[e("div",{staticClass:"sign-list sign-header"},[e("div",{staticStyle:{width:"160px"}},[t._v("签名")]),e("div",{staticStyle:{width:"100px"}},[t._v("审核结果")]),e("div",{staticStyle:{width:"80px"}},[t._v("状态")]),e("div",{staticStyle:{width:"100px"}},[t._v("操作")])]),t._l(t.signs,(function(i,s){return e("div",{key:s,staticClass:"sign-list"},[e("div",{staticStyle:{width:"160px"}},[t._v(t._s(i.sign_name))]),e("div",{staticStyle:{width:"100px"}},[t._v(t._s(i.status_value))]),e("div",{staticStyle:{width:"80px"}},[t._v(t._s(i.active?"使用中":"停用"))]),e("div",{staticStyle:{width:"100px"}},["success"===i.status?e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.toEdit(i)}}},[t._v(t._s(i.active?"停用":"启用"))]):t._e(),e("el-button",{attrs:{type:"text"},on:{click:function(e){return t.toDelete(i)}}},[t._v("删除")])],1)])}))],2),e("el-pagination",{staticStyle:{"text-align":"right"},attrs:{"current-page":t.signQuery.page,"page-size":t.signQuery.pageSize,total:t.signTotal,layout:"prev, next"},on:{"current-change":t.handleSignPage}}),e("div",{staticStyle:{margin:"20px 0"}},[e("el-button",{attrs:{type:"primary",size:"mini",disabled:0!==t.signs.filter((function(t){return t.isEdit})).length},on:{click:function(i){t.isAdd=!0}}},[t._v("新增签名")])],1)],1),t.isAdd?e("div",[e("div",{staticStyle:{"margin-bottom":"20px"}},[t._v("短信签名需提交到短信运营商审核，预计1-2个工作日，签名只允许3-8个字符，且必须包含汉字，不允许特殊字符")]),e("el-input",{staticClass:"el-form-item",class:{"is-error":t.error},on:{blur:function(i){return t.testSign(t.sign)},focus:t.restartTest},model:{value:t.sign,callback:function(i){t.sign=i},expression:"sign"}}),e("div",{staticClass:"error-tip"},[t._v(t._s(t.error))])],1):t._e(),t.isAdd?e("div",{attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{size:"small"},on:{click:t.closeSign}},[t._v("关闭")]),e("el-button",{attrs:{size:"small"},on:{click:t.cancelSign}},[t._v("取消")]),e("el-button",{attrs:{size:"small",type:"primary",loading:t.btnLoading},on:{click:t.confirmSign}},[t._v("确定")])],1):t._e()]),e("el-dialog",{attrs:{visible:t.historyVisible,title:"短信使用历史",width:"800px","before-close":t.closeHistory}},[e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.hisLoading,expression:"hisLoading"}]},[e("div",{staticClass:"sms-list sms-header"},[e("div",{staticStyle:{width:"120px"}},[t._v("接收手机")]),e("div",{staticStyle:{width:"420px"}},[t._v("发送内容")]),e("div",{staticStyle:{width:"80px"}},[t._v("消费数量")]),e("div",{staticStyle:{width:"80px"}},[t._v("剩余数量")])]),t._l(t.history,(function(i,s){return e("div",{key:s,staticClass:"sms-list"},[e("div",{staticStyle:{width:"120px"}},[t._v(t._s(i.mobile))]),e("div",{staticStyle:{width:"420px"}},[t._v(t._s(i.content))]),e("div",{staticStyle:{width:"80px"}},[t._v(t._s(+i.amount))]),e("div",{staticStyle:{width:"80px"}},[t._v(t._s(i.next_amount))])])})),e("el-pagination",{staticStyle:{"text-align":"center","margin-top":"20px"},attrs:{"current-page":t.hisQuery.page,"page-size":t.hisQuery.pageSize,total:t.hisTotal,layout:"total, prev, pager, next, jumper"},on:{"current-change":t.handleHisPage}})],2)]),e("el-dialog",{attrs:{visible:t.tipShow,title:"提示","show-close":!1,"close-on-click-modal":!1,"close-on-press-escape":!1,center:""}},[e("div",{staticClass:"dialog-tip"},[e("div",[t._v("付款过程中请勿关闭当前页面，付款成功后请点击“付款成功”按钮")]),e("div",[t._v("付款失败或取消付款，请点击“取消付款”按钮，关闭弹窗")])]),e("div",{attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{size:"small"},on:{click:function(i){t.tipShow=!1}}},[t._v("取消付款")]),e("el-button",{attrs:{size:"small",type:"primary",loading:t.validLoading},on:{click:t.validPay}},[t._v("付款成功")])],1)])],1)},n=[function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",{staticClass:"message-content__header"},[e("div",{staticStyle:{width:"240px"}},[t._v("模版名称")]),e("div",{staticStyle:{width:"calc(100% - 360px)"}},[t._v("通知模版")]),e("div",{staticStyle:{width:"50px"}},[t._v("状态")]),e("div",{staticStyle:{width:"60px"}},[t._v("操作")])])},function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",{staticClass:"message-content__header"},[e("div",{staticStyle:{width:"240px"}},[t._v("模版名称")]),e("div",{staticStyle:{width:"calc(100% - 360px)"}},[t._v("通知模版")]),e("div",{staticStyle:{width:"50px"}},[t._v("状态")]),e("div",{staticStyle:{width:"60px"}},[t._v("操作")])])}],a=(e("d81d"),e("825f")),o=e("b775");function r(){return Object(o["a"])({url:"sms",method:"get"})}function c(t){return Object(o["a"])({url:"sms/"+t,method:"put"})}function l(t){return Object(o["a"])({url:"sms/log",method:"get",params:t})}function d(t){return Object(o["a"])({url:"sms/sign",method:"get",params:t})}function u(t){return Object(o["a"])({url:"sms/sign",method:"post",data:t})}function g(t,i){return Object(o["a"])({url:"sms/sign/"+t,method:"put",data:i})}function v(t){return Object(o["a"])({url:"sms/sign/"+t,method:"delete"})}var h={data:function(){return{loading:!1,customer_templates:[],admin_templates:[],buyVisible:!1,payLoading:!1,message_type:{},message_types:[],buyLoading:!1,payments:[],current_payment:"",signVisible:!1,sign:"",error:"",signs:[],signQuery:{page:1,pageSize:10},signTotal:0,signLoading:!1,isAdd:!1,btnLoading:!1,history:[],hisLoading:!1,hisTotal:0,hisQuery:{page:1,pageSize:15},historyVisible:!1,order_no:"",validLoading:!1,tipShow:!1}},created:function(){this.getTemplate()},methods:{getTemplate:function(){var t=this;this.loading=!0,this.customer_templates=[],this.admin_templates=[],r().then((function(i){var e=[];i.data.body.admin_order.map((function(t){t["isLoading"]=!1;var i=t;i["type"]="订单通知",e.push(i)})),t.admin_templates.push(e);var s=[];i.data.body.front_customer.map((function(t){t["isLoading"]=!1;var i=t;i["type"]="登录与注册",s.push(i)})),t.customer_templates.push(s);var n=[];i.data.body.front_order.map((function(t){t["isLoading"]=!1;var i=t;i["type"]="订单通知",n.push(i)})),t.customer_templates.push(n),t.loading=!1})).catch((function(){t.loading=!1}))},toBuy:function(){var t=this;this.buyVisible=!0,this.payLoading=!0,Object(a["e"])().then((function(i){t.message_types=i.data.body[0].variants,t.message_types.sort((function(t,i){return 1*t.time-1*i.time})),t.message_type=t.message_types[0],Object(a["d"])().then((function(i){t.payments=i.data.body,t.current_payment=t.payments[0].method_code,t.payLoading=!1})).catch((function(){t.payLoading=!1}))})).catch((function(){t.payLoading=!1}))},closeBuy:function(){this.buyVisible=!1},confirmBuy:function(){var t=this;this.buyLoading=!0;var i={shop_id:this.$store.getters.shop_id,payment_method:this.current_payment,item:{type:"sms",item_id:this.message_type.variant_id}};Object(a["a"])(i).then((function(i){t.order_no=i.data.body.no,t.$message.success({message:"正在跳转支付，请勿关闭当前页面",duration:2e3}),setTimeout((function(){window.open(i.data.body.payment.pay_url,"_blank"),t.buyLoading=!1,t.buyVisible=!1,t.tipShow=!0}),2e3)})).catch((function(){t.buyLoading=!1}))},validPay:function(){var t=this;this.validLoading=!0,Object(a["c"])(this.order_no).then((function(i){t.validLoading=!1,"paid"===i.data.body.status_code?(t.$message.success({message:"短信购买成功",duration:1e3}),setTimeout((function(){t.$store.dispatch("getUserInfo"),t.tipShow=!1}),1e3)):(t.$message.error({message:"未检测到成功的支付订单，请检查支付是否成功，如果确认支付成功，请联系客服核对",duration:4e3}),t.tipShow=!1)})).catch((function(){t.validLoading=!1,t.tipShow=!1}))},editSign:function(){this.signVisible=!0,this.getSigns(),this.sign=this.message.sign},getSigns:function(){var t=this;this.signLoading=!0,d(this.signQuery).then((function(i){t.signs=i.data.body.data,t.signTotal=i.data.body.page.total,t.signLoading=!1})).catch((function(){t.signLoading=!1}))},handleSignPage:function(t){this.signQuery.page=t,this.getSigns()},testSign:function(t){var i=/^.{3,8}$/,e=/^[\u4E00-\u9FA5A-Za-z0-9]+$/;i.test(t)?e.test(t)||(this.error="签名只能包含汉字、数字和英文字符，不允许特殊字符"):this.error="签名必须在3-8个字符"},restartTest:function(){this.error=""},closeSign:function(){this.error="",this.sign="",this.isAdd=!1,this.signVisible=!1},cancelSign:function(){this.restartTest(),this.isAdd=!1,this.sign=""},toDelete:function(t){var i=this;this.$confirm("是否确认删除？","提示",{confirmButtonText:"确定",cancelButtonText:"取消"}).then((function(){v(t.sign_id).then((function(){i.$message.success("删除成功"),i.getSigns()}))})).catch((function(){}))},toEdit:function(t){var i=this;g(t.sign_id,{active:!t.active}).then((function(){i.$message.success("更新成功"),i.getSigns()}))},confirmSign:function(){var t=this;this.sign?(this.btnLoading=!0,u({sign_name:this.sign}).then((function(){t.$message.success("提交成功，请等待审核"),t.cancelSign(),t.getSigns(),t.btnLoading=!1})).catch((function(){t.btnLoading=!1}))):this.$message.warning("请填写签名再提交")},changeStatus:function(t){var i=this;t.isLoading=!0,c(t.sms_template_id).then((function(){i.$message.success("更改成功"),i.getTemplate(),t.isLoading=!1})).catch((function(){t.isLoading=!1}))},smsHistory:function(){this.historyVisible=!0,this.getHistory()},getHistory:function(){var t=this;this.hisLoading=!0,l(this.hisQuery).then((function(i){t.history=i.data.body.data,t.hisTotal=i.data.body.page.total,t.hisLoading=!1})).catch((function(){t.hisLoading=!1}))},handleHisPage:function(t){this.hisQuery.page=t,this.getHistory()},closeHistory:function(){this.historyVisible=!1,this.history=[]}}},p=h,m=(e("e5a7"),e("11d5"),e("2877")),y=Object(m["a"])(p,s,n,!1,null,"60a60b52",null);i["default"]=y.exports}}]);